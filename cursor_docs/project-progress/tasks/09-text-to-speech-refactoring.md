# textToSpeech.ts のリファクタリング

**ステータス**: ✅ 完了
**ブランチ**: cursor/refactoring
**開始日**: 2023-03-23
**完了日**: 2023-03-24

## 概要
テキスト読み上げ機能の中核となる`textToSpeech.ts`モジュールのリファクタリングを行います。
チャンネル管理の改善とテキスト整形機能の分離を中心に実施します。

## タスク
- [x] アクティブチャンネル管理をモデルに移動
  - [x] 永続化機能の追加
  - [x] インターフェイスの明確化
- [x] テキスト整形機能を専用のモジュールに分離
  - [x] URLフィルタリングの改善
  - [x] メンション置換の強化
  - [x] 絵文字処理の拡張
- [x] エラーハンドリングの改善
  - [x] より詳細なエラーメッセージ
  - [x] リカバリー機能の実装

## 進捗メモ
- 2023-03-23: リファクタリング計画の作成
- 2023-03-23: textToSpeech.tsの全面的なリファクタリングを実施。以下の改善を行った：
  - `activeChannels.ts`モジュールを作成し、アクティブチャンネルの管理と永続化機能を実装
  - `messageFormatter.ts`モジュールを作成し、テキスト整形機能を分離
  - エラーハンドリングを改善し、エラータイプに応じた適切な処理を実装
  - コマンドファイルも更新し、新しいモジュール構造に対応
- 2023-03-24: voiceコマンドの構造変更と関連ファイルの修正
  - `join`と`leave`の個別コマンドからサブコマンドを持つ単一の`voice`コマンドに変更
  - コマンドハンドラとテストを更新
  - テスト対応のためのエラーハンドリングを強化
- 2023-03-24: テスト環境のエラーを修正し、全てのテストが正常に動作することを確認 